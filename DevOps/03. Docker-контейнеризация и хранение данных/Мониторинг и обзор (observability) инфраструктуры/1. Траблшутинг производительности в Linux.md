*В ОС Linux есть встроенный инструментарий для сбора статистики о работе системы* 
#### ***Мониторинг производительности: `vmstat`***

***Вывод команды:*** 
![[Pasted image 20251215220231.png]]

- `vmstat` с кличем `w` используют для вывода расширенной информации, а с `s` - для вывода общей статистики использования памяти ядра и основных подсистем виртуальной памяти 
![[Pasted image 20251215220509.png]]
- Чтобы увидеть изменения нагрузки в динамике, используем команду `vmstаt x`, где `x` - интервал в секундах, с которым утилита будет опрашивать и выводить новые значения 
#### ***Процессор: `top`***

- Для сортировки процессов по использованию CPU: команды `top` и сочетание `Shift + P`. После нажатия `Shift + m` процессы отобразятся в порядке убывания использования памяти 
![[Pasted image 20251215221024.png]]
![[Pasted image 20251215221040.png]]

- Для просмотра загрузки каждого ядра процессора: команда `top` и клик по `1`. Плюс этой опции в том, что вы получаете данные по ядрам в отдельности - это полезно при мониторинге многоядерных систем 
![[Pasted image 20251215221247.png]]
#### ***Оперативная память: `free`***

*Это команда предоставляет информацию об использовании оперативной памяти*
1. Человекочитабельный формат: для более удобного отображения в гигабайтах используем ключ `h` - `free -h`
2. Ключ `s N` выводит дополнительную статистику об использовании оперативной памяти и означает обновление каждые N секунды. Например `free -s 2` обновляет данные каждые две секунды 
3. Ключ `t` показывает итоговую строку суммарно по всем столбцам 
![[Pasted image 20251215221800.png]]
#### ***Жёсткий диск: `df`***

`df` — disk free. Команда показывает данные о доступном месте на диске
- Человекочитаемый формат: для более удобного чтения добавьте ключ `h` — `df -h`.
- Ключ `a` в `df` отображает информации о всех файловых системах — включая те, что обычно не отображаются по умолчанию.
- Ключ `T` показывает тип файловой системы для каждой точки монтирования.
- Ключ `x` позволяет исключить определённые типы файловых систем из отображения. Так, например, мы исключим файловые системы типа `tmpfs` из вывода: `df -x tmpfs`
![[Pasted image 20251215222035.png]]
![[Pasted image 20251215222047.png]]
#### ***Сетевая активность***

`ip` - предназначена для настройки сетевых интерфейсов, но может предоставлять и данные 
- С помощью `ip route show` можно посмотреть текущие маршруты IP-адресов на вашей системе 
- Статистику по сетевым интерфейсам покажет ключ `s`: `ip -s link show`
- Еще ключ `s` можно использовать для отображения статистики по IP-адресам на каждом интерфейсе `ip -s address show`
![[Pasted image 20251215222435.png]]

`ss` (Socket Statistics) - утилита командной строки, которая предоставляет информацию о сокете: открытые порты, соединения TCP/UDP, маршрутизации и различные сетевые интерфейсы 
- `tuln` показывает все открытые TCP/UDP-сокеты без разрешения имён: `ss -tuln`.
- `s` даёт общую статистику использования сокетов, что полезно при мониторинге активности сетевых соединений. Так, команда `ss -s` покажет данные по используемым сокетам на системе.
- Фильтрация по состоянию соединения `state established` помогает выделить активные соединения, что облегчает отслеживание текущих сессий: `ss state established`.
- `dst` быстро выявляет активные соединения с определённым узлом в сети. К примеру, команда `ss dst &lt;IP-адрес&gt;` покажет все соединения к указанному IP-адресу: `ss dst 192.168.1.1`.
- `i` предоставляет информацию о сетевых интерфейсах и маршрутизации, сетевой конфигурации сервера. Так можно получить данные о сетевых интерфейсах, маршрутизации и статистике пакетов: `ss -i`.
- `p` выводит связанные с PID-соединениями имена процессов, что полезно при отслеживании взаимодействующих по сети процессов: `ss -p`
![[Pasted image 20251215222820.png]]
![[Pasted image 20251215222902.png]]
![[Pasted image 20251215222924.png]]
![[Pasted image 20251215223016.png]]
![[Pasted image 20251215223037.png]]

`Tcpdump` - утилита командной строки, используемая для захвата и анализа пакетов сети
- `-i` захватывает трафик на определённом интерфейсе. Так, `eth0` в `tcpdump -i eth0` — имя сетевого интерфейса.
- `-n` выводит IP-адреса числами: `tcpdump -n`.
- `-s` ограничивает размер захватываемых пакетов. К примеру, до 128 байт: `tcpdump -s 128`. Такая функция полезна для уменьшения нагрузки на систему при обработке большого объёма трафика.

***Метрики*** 

***Вывод команды `top`:*** 
![[Pasted image 20251216185631.png]]

#### ***1. Load Average, или LA, — средняя загрузка***

В Linux **LA** отражает среднею нагрузку на систему за определенный период времени. Этот показатель представлен тремя числами - обычно в формате `Load Average: 0.26, 0.20, 0.18`. Каждое из чисел относится к определенному временному интервалу: за последнюю минуту, за последние 5 минут и 15 минут 

*LA должна быть сопоставимой с количеством ядер процессора. Если это значение превышено, это может быть сигнал о повышенной загрузке* 

***Как Linux считает эту метрику:*** 
1. Появившись, процесс получает приоритет и вес 
2. Система смотрит на количество процессов в очереди - это значение показывает  Load Average
3. Если Load Average ниже числа ядер процессора, все в порядке 
4. Значение, превышающие количества ядер, могут сигнализировать о перегрузке 

***Значения LA не всегда достаточно:*** 
- Не учитывает контекст процессов (не показывает какие конкретно из них создают нагрузку на систему)
- Не учитывает операции ввода-вывода 
- Может быть неточной в многопроцессорных системах
- Не учитывает асимметричные нагрузки 

#### ***2. Tasks, или задачи***

- `total` - их общее количество 
- `running` - количество активных задач
- `sleeping` - количество остановленных задач 
- `zombie` - количество зомби-процессов 
#### ***3. Использование процессора — `%Cpu(s)`***

- `us`: использование процессора пользовательскими процессами;
- `sy`: время выполнения процессов ядра;
- `id`: простой процессора, когда он не используется;
- `wa`: ожидание ввода или вывода;
- `hi`: обработку аппаратных прерываний;
- `si`: обработку программных прерываний;
- `st`: время, которое процессор тратит на виртуализацию другого процессора.
#### ***4. Использование памяти — `MiB Mem`***

- `total`: общее количество оперативной памяти;
- `free`: доступное количество свободной памяти;
- `used`: используемая память;
- `buff/cache`: размер буфера и кэша памяти.
#### ***5. Использование `Swap` — `MiB Swap`***

- `total`: общее количество `swap`-памяти;
- `free`: cвободное место в `swap`-памяти;
- `used`: используемая `swap`-память;
- `avail Mem`: количество доступной оперативной памяти для новых процессов.

***Вывод команды `vmstat`:*** 
![[Pasted image 20251216191705.png]]

1. `Procs` - эта группа содержит информацию о выполняющихся блокированных процессах. Она позволяет оценить, насколько загружены ядра процессора, какие процессоры находятся в состоянии готовности или блокировки
- `r` - количество процессов, ожидающих выполнение 
- `b` - количество процессов, находящиеся в состоянии блокировки 

2. `Memory` - отражает данные об использовании памяти. Здесь можно узнать, сколько оперативной памяти используется, как много свободной памяти доступно, а также получить информацию о буферной кэш-памяти
- `swpd`: использование `swap`-памяти, то есть размер виртуальной памяти, которая находится в области подкачки;
- `free`: количество свободной оперативной памяти;
- `buff`: количество используемой буферной памяти ядра;
- `cache`: количество используемой кэш-памяти файловой системы.

3. `Swap` - предоставляет информацию об использовании области подкачки
- `si`: средняя скорость чтения данных с области подкачки в мегабайтах в секунду;
- `so`: средняя скорость записи данных в область подкачки в мегабайтах в секунду.

4. `IO` - содержит информацию о вводе-выводе данных 
- `bi`: количество блоков данных, прочитанных с устройств блочного ввода-вывода в секунду;
- `bo`: количество блоков данных, записанных на устройства блочного ввода-вывода в секунду.

5. `system` - находится информация о системных действиях 
- `in`: cреднее количество обработанных прерываний в секунду, включая обработку сетевых пакетов;
- `cs`: cреднее количество контекстных переключений процессов в секунду.

6. `CPU` - показывает информацию об использовании процессора 
- `us`: процент времени CPU, затраченного на выполнение пользовательских процессов;
- `sy`: время выполнения процессов ядра;
- `id`: процент времени, в течение которого CPU простаивает (`idle`);
- `wa`: процент времени, в течение которого CPU ожидает завершения операций ввода-вывода.
#### ***Вывод команды `df`***
![[Pasted image 20251216192647.png]]

1. `Filesystem` — название файловой системы, на которую ссылается запись.
2. `1K-blocks` показывает общий объём доступного пространства в килобайтах на указанной файловой системе.
3. `Used` — количество использованных килобайтов.
4. `Available` — количество доступных килобайтов для записи.
5. `Use%` — процент использования доступного пространства на файловой системе.
6. `Mounted on` — место в файловой системе, куда произошло её монтирование, например, `/, /home, /var`.
#### ***Вывод команды `ss`***
![[Pasted image 20251216192813.png]]

1. Столбец `Netid` показывает идентификатор сети, к которой относится соединение. Например, `u_str` может указывать на сокеты домена Unix.
2. `State` отражает текущее состояние сокета. В нашем выводе все соединения находятся в состоянии `ESTAB` — это означает, что соединение установлено.
3. `Recv-Q` позволяет увидеть размер очереди приёма данных, а `Send-Q` — отправки. Их значения в примере — `0`, что свидетельствует об отсутствии активной передачи данных.
4. `Local Address:Port` показывает локальный адрес и порт соединения. Например, `/run/systemd/journal/stdout 15006` указывает на Unix-доменный сокет для журнала `systemd` с `PID 15006`.
5. `Peer Address:Port` находится в значении — то есть конкретного удалённого адреса или порта нет. Скорее всего, это указывает на локальное соединение или сокет без удалённого адреса.
6. `Process` предоставляет идентификатор процесса `PID`, связанного с сокетом. Например, `15006` и `15277` — идентификаторы процессов, связанных со строками `/run/systemd/journal/stdout`.

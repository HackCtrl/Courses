## ***Пользователи: `root`***

`root` - это пользователь с максимальными привилегиями в системе. Он может выполнять любые действия. 

***Почему опасно работать под `root`?***
1. Отсутствие ограничений на действия 
2. Вероятность ошибок 
3. Угроза безопасности 
## ***Пользователи: команда `sudo`***

`sudo` (superuser do) - это команда, которая позволяет обычным пользователям временно получить привилегии root для выполнения отдельных задач

***Пример команды:*** 

`sudo dpkg -i install.deb`

***Преимущества sudo:***
- Повышенная безопасность: привилегии предоставляются временно и ограничены определенными командами и опциями/аргументами 
- Логирование: все действия можно записывать в журнал log 
- Дополнительная защита: для дополнительных действий требуется дополнительные команды и требуется вода пароля

`sudo` - отдельные привилегированные операции 
`root` - длительные и постоянные административные задачи 
## ***Создание пользователей и управление ими***

#### ***Создание пользователя***

`useradd` - создать нового пользователя: 
`sudo useradd -m adm-user` (флаг `-m` создает домашнею директорию `/home/adm-user`)
`passwd` - установить или изменить пароль: 
`sudo passwd adm-user`
#### ***Смена пользователя***

`sudo su` - меняет одного пользователя на другого: 
`sudo su adm-user`
`sudo su` - на root
#### ***Управление группами пользователей***

`groupadd` - создать новую группу: 
`sudo groupadd adm-students` (создали новую группу)
`sudo usermod -aG adm-students adm-user` (теперь adm-user член группы students с правами, которые выделены группе)
`userdel` - удалить пользователя из системы
`sudo userdel adm-user`
`sudo userdel -r adm-user` - (удалить вместе с домашней директорией)
## ***Права доступа***

#### ***Логика назначения прав доступа***

***Права доступа делятся на три уровня:***
1. Владелец (`user`) - пользователь, которому принадлежит файл или каталог или же который создал их 
2. Группа (`group`) - группа пользователей, которым можно предоставить права на файл 
3. Все остальные (`others`) - прочие пользователи системы. Они не входят в группу и не являются владельцами
***Для каждого уровня есть 3 вида прав:*** 
- `r` (read) - права на чтение файла или содержимого каталога 
- `w` (write) - права на изменение или удаление файла 
- `x` (execute) - право на выполнение файла как программы

***Схематично права доступа для файла или каталога можно представить так:***
![[Pasted image 20251108112139.png]]

***Компоненты схемы. В `drwxr-xr--` первая буква указывает на тип сущности:*** 
- `d` - директория 
- `-` файл 
- `l` - символическая ссылка 
***Далее три блока, каждые по 3 символа:*** 
- `rwx` (первый блок) - права владельца
- `r-x` (второй блок) - права группы 
- `r--` (третий блок) - права для всех остальных 

***Пример:*** 
`-rwxr-xr--` (владелец файла `-` может читать, изменять и выполнять его `rwx` , группа может только читать и выполнять `r-x` , а остальные пользователи могут только читать `r--` 
## ***Команда `chmod`***

`chmod` - изменяет права доступа к файлам и директориям. Это можно сделать двумя способами: символичным и числовым 

***Символичное представление. Символами можно явно указать, какие права хотим добавить, удалить или изменить для:*** 
- `u` (user) - владельца 
- `g` (group) - группы
- `o` (others) - остальных 
- `a` (all) - всех 
***Есть и операторы:*** 
- `+` - добавить права 
- `-` - удалить права 
- `=` - назначить указанные права 

***Так выглядит схема символьного представления:***
![[Pasted image 20251108114111.png]]

`chmod u+x file.sh` - добавляет владельцу право на выполнение (`u+x`) файла file.sh. А `chmod g-w std-project/` - удаляет у группы право на запись (`g-w`) в директории std-project

***Числовое представление. Три числа, обозначающие права для владельца, группы и остальных пользователей. Каждое из этих чисел образуется в результате сложения значений:*** 
- `r` (чтение) = 4
- `w` (запись) = 2 
- `x` (выполнение) = 1

Пример `chmod 755 file.sh`: 
- 7 = 4 + 2 + 1 (владелец может читать, писать и выполнять)
- 5 = 4 + 1 (группа может читать и выполнять)
- 5 = 4 + 1 (остальные могут читать и выполнять)

***Опции:*** 
- `R` - изменить права для всех файлов и каталогов внутри указанной директории
- `c` - вывести подробную информацию о выполняемых изменениях 
- `f` - не выводить сообщения об ошибках 

***Если нужно изменить права доступа на 755 у всех файлов и директорий в директории /home/adm-user/:*** 
`sudo chmod -R 755 /home/adm-user/`
## ***Команда `chown`***

`chown` - меняет владельца и группу файла или каталога 

***Детали работы команды:*** 
- Если указать только владельца, изменится только он 
- Если указать владельца и через двоеточие группу, изменятся и владелец и группа 
- Если нужно изменить только группу, можно пропустить владельца, но оставить двоеточие, например `:groupname`

***Например мы хотим изменить владельца директории std-project на пользователя adm-user, а группу на students:*** 
`sudo chown adm-user:students std-project/`

***А если нужно изменить только группу файла log.txt на students:*** 
`sudo chown :students log.txt` 

Можно использовать -R (рекурсивное изменение) и с (подробный вывод изменений). Если необходимо изменить владельца и группу всех файлов и подкаталогов в директории /home/adm-user/: 
`sudo chown -R adm-user:students /home/adm-user/`
## ***Файл `sudoers`***

`/etc/sudoers` - определяет какие пользователи и группы могут использовать sudo 

***/etc/sudoers важно использовать `visudo`- специальная команда для редактирования конфигов sudo:*** 
- Редактирование sudores с помощью обычного текстового редактора опасно. Из за ошибки в синтаксисе можно лишиться возможности использования sudo
- `visudo` проверяет синтаксис перед сохранением. Это снижает вероятность ошибок, если синтаксис не правильный, изменение не сохраняется
#### ***Формат записи в `sudoers`***

***Запись в sudoers могут быть настроены как для отдельных пользователей, так и для групп***: 
`user_name ALL=(ALL) ALL`
`user_name` - имя пользователя, дальше 3 значения `ALL`: 
1. В многопользовательских системах команда может выполняться на любой машине 
2. Команды могут выполняться от имени любого пользователя. Обычно это root 
3. Пользователь может выполнять любые команды

***Настройка для группы:*** 
`%students ALL=(ALL) ALL` (позволяет всем пользователям, входящим в группу students выполнять любые команды через sudo)
#### ***Ограничение команд***

***Пользователю можно разрешить выполнять определённые команды без ввода пароля. Если хотим, чтоб пользователь user_name мог перезагружать систему без пароля:*** 
`user_name ALL=(ALL) ALL NOPASSWD: /sbin/reboot`

***А если необходимо разрешить `adm-student` использовать `dpkg -i` и `reboot`, но запретить все остальные команды через `sudo`, в том числе и удаление пакетов с помощью `dpkg -r`***: 
`adm-students ALL=(ALL) /usr/bin/dpkg -i, /sbin/reboot`

***Принцип минимальных привилегий*** - организация доступа, когда модуль, процесс, пользователь или программа обладают доступом к таким ресурсам и информации, которые минимально необходимы для успешного выполнения рабочий цели


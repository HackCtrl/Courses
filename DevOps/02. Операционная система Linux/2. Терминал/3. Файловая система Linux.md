***ФС*** - это способ организации и хранения данных на жестких дисках, SSD или USB-накопителях. ФС определят, как файлы и папки-каталоги хранятся и управляются, как мы можем к ним обращаться 
## ***Устройство файловых систем***

***ФС состоит из трех компонентов:*** 
- Файлы - основные единицы хранения данных 
- Директории - они же папки и каталоги, позволяют организовывать файлы 
- Метаданные - информация о файлах 

***Для чего нам нужны ФС:*** 
- Организации данных 
- Обеспечение доступа 
- Управление памятью 
- Восстановление данных 

***Алгоритм управления пространством на диске. Основные операции:***
1. Запись данных
2. Создание метаданных 
3. Обновление файлов 
4. Чтение данных 
## ***Типы файловых систем в Linux***

## ***ext4***

***ext4*** - одна из самых распространенных ФС в linux. Она предлагает стабильность, высокую производительность и надежность при обычных нагрузках 

***Особенности ext4:*** 
- Надежность 
- Поддержка больших файлов и разделов 
- Высокая производительность 

***Преимущества этой системы:*** 
- Стабильность и надежность 
- Поддержка крупных файлов и размеров 
- Поддержка журнала для защиты от сбоев 

***Недостатки:*** 
- Отсутствие встроенных функций 
- Ограниченная гибкость 

***LVM (Logical Volume Manager)*** - система в Linux, которая позволяет гибко управлять дисковым пространством 

- Устаревшие механизмы управления 

***RAID*** - это избыточный массив дисков, технология виртуализации данных для объединения нескольких физических дисковых устройств в логический модуль, повышающая отказоустойчивость и производительность

- Проблема с производительностью при работе с большим количеством небольших данных 

***ext4 следует использовать:*** 
- С рабочими станциями и серверами общего назначения 
- В системах, где важна надежность и предсказуемая производительность 
## ***Btrfs***

***Btrfs*** - современная и продвинутая ФС, созданная для управления большим объемом данных. Она поддерживает снапшоты, сжатие, клонирование и встроенные функции RAID

***Ее характеристик:*** 
- Снапшоты позволяют создавать моментальные снимки ФС, которые можно использовать для быстрого восстановления данных 
- Встроенная поддержка сжатия 
- Отслеживает повреждение данных и автоматически восстанавливает их 
- Поддерживает гибкое управление многодисковыми конфигурациями и встроенные функции RAID

***Преимущества:*** 
- Гибкость в управлении данными 
- Поддержка моментальных снимков и клонирования 
- Встроенные функции сжатия и RAID 
- Возможность автоматического восстановления поврежденных данных 

***Недостатки:*** 
- Нестабильность 
- Высокие требования к ресурсам 
- Восстановление данных может быть более сложным
- Производительность при использовании RAID может быть ниже 

***Следует использовать:*** 
- Система, где важны резервные копии и восстановление
- Динамичные системы с высокой частотой изменения данных 
- Системы с высокой отказоустойчивостью 
## ***XFS***

***XFS*** - ориентирована на работу с большим объемом данных и высокими нагрузками на ввод-вывод 

***Особенности:*** 
- Поддержка больших ФС
- Высокая производительность при работе с крупными файлами
- Масштабируемость и высокая эффективность

***Преимущества:*** 
- Высокая производительность при работе с большими файлами и нагрузками 
- Поддержка крупных файлов и ФС 
- Масштабируемость

***Недостатки:*** 
- Ограниченная поддержка мелких файлов 
- Отсутствие встроенных функций управления данными 
- Сложность расширения 
- Риск потери данных при сбое 

***Следует использовать:*** 
- Серверы БД и системы хранения 
- Система с высокими нагрузками на файловый ввод-вывод 
## ***ZFS***

***ZFS*** - одна из самых надежных ФС. Объединяет возможности управления файлами и томами данных, обеспечивает высокую защиту информации от повреждения и встроенные функции резервного копирования

***Основные характеристики:*** 
- Защита от повреждения данных 

***Контрольные суммы*** - можно сравнить с уникальными отпечатками данными, если что то случайно повредилось, с их помощью система замечает это 

- Поддержка снапшотов и клонирования данных 
- Встроенные функции RAID
- Эффективное управление большим объемом информации 

***Преимущества:*** 
- Высокая степень защиты данных 
- Поддержка моментальных снимков и клонирования 
- Встроенные функции RAID 
- Масштабируемость 

***Недостатки:*** 
- Требует значительных ресурсов оперативной памяти для нормальной работы 
- Установка и администрирование ZFS могут быть сложнее, чем у других ФС 
- У ZFS есть лицензия
- На некоторых Linux-дистрибутивах не включен по умолчанию 

***Следует использовать:*** 
- Система хранения, где важна надежность и целостность данных, их легкое и быстрое восстановление 
- Система с высокой нагрузкой и большими объемами информации 
## ***Стандарт FHS***

***FHS*** ***(Filesystem Hierarchy Standard стандарт иерархии файловой системы)*** - описывает структуру каталогов, то есть общие правила размещения файлов в Unix подобных системах 
#### ***Основные каталоги FHS***
- `/` — корневой каталог;
- `/bin` — системные бинарные файлы (команды), которые доступны на всех уровнях системы даже в режиме восстановления;
- `/boot` — загрузочные файлы;
- `/etc` — конфигурационные файлы системы, к примеру, здесь хранятся настройки служб, сетевых подключений и пользователей;
- `/dev` — файлы устройств: жёсткие диски, сетевые интерфейсы, периферийные устройства;
- `/home` — домашние каталоги пользователей;
- `/root` — домашний каталог суперпользователя;
- `/lib` — основные библиотеки;
- `/mnt` — временно монтируемые файловые системы;
- `/opt` — дополнительное ПО;
- `/var` — динамические данные: логи, временные файлы или очереди печати;
- `/tmp` — временные файлы, которые могут удаляться автоматически;
- `/usr` — дополнительная директория для данных пользователя, например, для пользовательских бинарных файлов.
## ***Иноды: что это и для чего они нужны***

***Иноды (index node — «индексный дескриптор»)*** - это структуры данных, которые содержат информацию о файле или каталоге в ФС, но не сам файл или каталог. Например, это могут быть права доступа, размер файла, время последнего изменения и местоположения блоков данных на диске

***Что важно знать о инодах:*** 
- У каждого файла в Linux есть свой инод
- Инод не содержит имя файла, они хранятся в каталоге, который, в свою очередь, ссылается на инод 
- Если на диске закончатся иноды, создать новые файлы не получится 
#### ***Как посмотреть количество свободных инодов***

`df -i` - команды для проверки количества свободных инодов. Она показывает информацию о файловых системах, включая использование инодов

***Вывод команды:*** 
![[Pasted image 20251108151113.png]]

***Пять столбцов:*** 
- `Inodes` - общее количество инодов ФС 
- `IUsed` - количество использованных инодов 
- `IFree` - количество свободных инодов 
- `IUse%` - процент использованных инодов 
- `Mounted on` - путь к точке монтирования файловой системы 
## ***Команды для работы с файловой системой***

***Команды:***
- `find` ищет файлы по разным критериям — имени, дате создания, размеру и так далее. Команда для поиска файла с именем `file.txt` в каталоге `/home` будет выглядеть так: `find /home -name "file.txt"`.
- `du` показывает, сколько места занимает файл или каталог. Так, команда `du -sh /var/log` покажет размер каталога `/var/log`.
- `cp` копирует файл. С помощью `cp -r /home/user /home/user_bck` мы скопируем директорию `/home/user` в директорию `/home/user_bck`, сменив в процессе её название.
- `mv` перемещает файл. Команда `mv /home/user/test_doc.txt /home/user/test_dir` переместит файл `test_doc.txt` из директории `/home/user` в директорию `/home/user/test_dir`.
- `ncdu` — утилита с удобным интерфейсом для анализа дискового пространства.
- `df` отображает информацию о свободном и занятом пространстве в ФС. Команда `df -h` выведет данные в удобочитаемом формате.
- `fd` — альтернатива `find` для поиска файлов.
- `lsblk` отображает информацию обо всех доступных блоковых устройствах, включая диски и их разделы. К примеру, `lsblk -f` добавит в вывод информацию о файловой системе.
## ***Работа с дисками и архивами***

#### ***Монтирование дисков***

*В Linux диски и устройства монтируются в ФС с помощью команд*

***Монтирование*** - подключение дискового пространства к ФС, в результате система может обращаться в нему через конкретный каталог. Этот каталог называется точкой монтирования 

***Команды монтирования:*** 
- `mount` - монтирует диск: 
`mount /dev/sdb1 /mnt` - подключить раздел диска /dev/sdb1 в каталог /mnt 
- `umount` - демонтирует диск: 
`umpunt /mnt` - отключит диск из каталога /mnt

***Процесс:*** 
1. Создание точки монтирования: 
`sudo mkdir /mnt/storage` - перед монтирование создаем папку, точку монтирования, куда подключится диск 
2. Монтирование диска: 
`sudo mount /dev/sdb1 /mnt/storage` - подключаем диск к системе 
3. Проверка смонтированных ФС: 
`df -h` - проверяем какие диски смонтированы, отобразит список подключенных ФС и инфу о свободном месте на них 
4. Добавление диска в автозагрузку: 
`sudo nano /etc/fstab` - добавим в файл для автоматического монтирования диска при старте системы: 
`/dev/sdb1 /mnt/storage ext4 defaults 0 0` 
#### ***Создание архивов и сжатие файлов***

***Архивы*** - позволяют объединить несколько файлов в один и уменьшить их размер за счет сжатия (компрессия)

***Разберём работу с архивами и компрессией на примере архиватора tar:***
- `tar -cvf archive.tar /home/user/` создаст архив `archive.tar` из содержимого каталога `/home/user/`,
- `tar -xvf archive.tar` разархивирует `archive.tar` в текущую директорию,
- `tar -cjvf archive.tar.bz2 /home/user/` создаст архив `archive.tar.bz2` из содержимого каталога `/home/user/` с использованием сжатия **bzip2**,
- `tar -xjvf archive.tar.bz2` разархивирует и проведёт декомпрессию архива `archive.tar.bz2` в текущую директорию,
- `tar -czvf archive.tar.gz /home/user/` создаст архив `archive.tar.gz` из содержимого каталога `/home/user/` с использованием сжатия **gzip**,
- `tar -xzvf archive.tar.gz` разархивирует и проведёт декомпрессию `archive.tar.gz` в текущую директорию.
## ***Траблшутинг***

#### ***Проблема №1. Невозможно монтировать диск***

#### ***Решение***
1. Проверим состояние диска: 
`lsblk -f`
2. Проверим логи системы: 
`dmesg | grep sdb`
3. Исправить ошибки файловой системы: 
`sudo fsck /dev/sdb1`
4. Пробуем вручную монтировать диск: 
`sudo mount /dev/sdb1 /mnt`
#### ***Проблема №2. Ошибка при создании архива***

#### ***Решение***
1. Проверим доступное место на диске: 
`df -h`
2. Проверим права на файлы и каталоги: 
`ls -l /path/to/file`
3. Использовать правильные параметры архивации 
#### ***Проблема №3. Ошибка с RAID***

#### ***Решение***
1. Проверим состоянии RAID: 
`cat /proc/mdstat`
2. Диагностируем проблему 
3. Восстановим RAID-массив: 
`sudo mdadm --assemble --scan`
#### ***Проблема №4. Отсутствие прав для монтирования диска***

#### ***Решение***
1. Проверим права пользователя: 
`sudo mount /dev/sdb1 /mnt`
2. Проверим права на директорию монтирования: 
`ls -ld /mnt`
#### ***Проблема №5. Раздел повреждён или отсутствует***

#### ***Решение***
1. Проверим состояние разделов: 
`sudo fdisk -l`
2. Используем fsck для восстановления файловой системы: 
`sudo fsck /dev/sdb1`
3. Если раздела нет, создадим новый: 
#### ***Проблема №6. Данные недоступны после сбоя файловой системы***

#### ***Решение***
1. Проверим состояние ФС: 
`sudo fsck /dev/sdb1`
2. Используем логи для диагностики: 
`dmesg: dmesg | grep sdb`
3. Реинициализируем RAID
#### ***Linux как ядро сети***

![[Pasted image 20251116114608.png]]
*Так можно представить маршрутизацию на Linux*
#### ***Система хранения данных***
![[Pasted image 20251116114703.png]]
*Устройство файлового сервера*
#### ***DHCP и DNS***

***DHCP (Dynamic Host Configuration Protocol — «протокол динамической настройки узла») и DNS (Domain Name System — «система доменных имён»)*** - DNS преобразует тестовые имена узлов в IP-адреса, необходимые для маршрутизации сетевого трафика. DNCP позволяет устройствам автоматически получать эти преобразованные адреса и другие значения, которые нужны для подключения к сети 
#### ***Масштабирование и балансировка веб-приложений***

## ***Почему иногда ресурсов не хватает***

***Пиковые нагрузки:***
- Всплески активности 
- Сезонность 
***Неэффективный код:***
- Плохая оптимизация 
- Утечка памяти 
***Ошибки конфигурации:***
- Неправильная настройка сервера 
- Проблема с сетевым соединением 
***Рост приложения:***
- Новые функции 
- Постоянный рост количества пользователей 
***Внешние факторы:***
- DDoS атаки 
- Перебои в работе провайдера хостинга 
## ***Масштабирование***

***Масштабирование*** - это процесс увеличения ресурсов сервера для обработки большого количества запросов. Оно позволяет справляться с пиковыми нагрузками 

***Существует два типа масштабирования:***
- вертикальное — это увеличение мощности существующего сервера, например добавление оперативной памяти, процессорных ядер или дискового пространства;
- горизонтальное — это добавление новых серверов в систему, позволяет распределять нагрузку между несколькими серверами, увеличивая общую производительность.
#### ***Вертикальное масштабирование***

***Плюсы:*** 
- Прозе в реализации 
- Меньше затрат на инфраструктуру 
- Лучшая производительность для небольших приложений 
***Минусы:***
- Ограниченный потенциал масштабирования
- Большая стоимость единицы мощности 
- Риск недоступности ресурсов 
#### ***Горизонтальное масштабирование***

***Плюсы:***
- Повышенная масштабируемость
- Высокая доступность 
- Экономичность 
***Минусы:***
- Сложнее в реализации 
- Повышенные затраты на инфраструктуру 
- Усложнения администрирования 
- Проблемы с балансировкой нагрузки
## ***Балансировка нагрузки***

***Балансировка нагрузки*** - это распределение входящего трафика между несколькими серверами. Она обеспечивает равномерную нагрузку на все серверы, предотвращая перегрузку одного из них и обеспечивая доступность приложения, даже если один из серверов выйдет из строя (работает вместе с масштабированием -масштабирование - предоставляет больше ресурсов, а балансировка нагрузки обеспечивает их оптимальное использование)

*Важно понимать, что балансировка нагрузки актуальна только при горизонтальном масштабировании.*
#### ***Какие бывают балансировщики***

***Программные балансировщики нагрузки:***
- nginx
- HAProxy
- Apache HTTP Server
***Облачные сервисы балансировки нагрузки:***
- AWS Elastic Load Balancer (ELB)
- Google Cloud Load Balancing
- Azure Load Balancer
***Аппаратные балансировщики нагрузки:***
- F5 BIG-IP
- Cisco Application Control Engine (ACE)
#### ***Как балансировщики распределяют нагрузку***

***Round Robin — круговая очередь:***
- Принцип работы: запросы направляются на каждый сервер по очереди.
- Преимущества: простой и легко реализуемый алгоритм.
- Недостатки: не учитывает загруженность серверов. Если один сервер медленнее других, он будет получать больше запросов, что может привести к перегрузке.
***Least Connections — наименьшее количество подключений:***
- Принцип работы: запросы направляются на сервер с наименьшим количеством активных подключений.
- Преимущества: учитывает загруженность серверов.
- Недостатки: может привести к неравномерному распределению запросов между серверами, если они имеют разную производительность.
***Weighted Round Robin — взвешенная круговая очередь:***
- Принцип работы: запросы направляются на каждый сервер по очереди, но с учётом веса каждого сервера. Серверы с более высоким весом получают больше запросов.
- Преимущества: позволяет учитывать производительность серверов и распределять запросы более равномерно.
- Недостатки: требует настройки весов для каждого сервера.
***IP Hash — хеширование по IP:***
- Принцип работы: запросы от одного IP-адреса всегда направляются на один и тот же сервер.
- Преимущества: обеспечивает сохранение сессии пользователя на одном сервере.
- Недостатки: не учитывает загруженность серверов и может привести к перегрузке одного сервера.
***Least Response Time — наименьшее время отклика:***
- Принцип работы: запросы направляются на сервер с наименьшим временем отклика.
- Преимущества: обеспечивает быстрое обслуживание пользователей.
- Недостатки: может привести к неравномерному распределению запросов, если серверы имеют разную производительность.
***Random — случайный выбор:***
- Принцип работы: запросы направляются на случайно выбранный сервер.
- Преимущества: простой и эффективный алгоритм, если серверы имеют одинаковую производительность.
- Недостатки: не учитывает загруженность серверов и может привести к перегрузке одного сервера.

***Балансировщики нагрузки также могут использовать различные методы распределения нагрузки, например:***
- DNS-балансировку — направление запросов на разные IP-адреса серверов с помощью DNS-записей;
- SSL-балансировку — распределение трафика на базе SSL-сертификатов;
- Проксирование — использование прокси-сервера для перенаправления запросов на разные серверы.

***Когда целесообразно использовать балансировку нагрузки:***
- Если на приложении высокая нагрузка 
- Если предсказать нагрузку невозможно 
- Если приложение критически важно для бизнеса 
#### ***Балансировка нагрузки на примере nginx***

***nginx*** — высокопроизводительный, гибкий и масштабируемый реверс-прокси и балансировщик нагрузки с открытым исходным кодом. Он обеспечивает высокую доступность, эффективное распределение нагрузки и простоту управления минимальными затратами. Кроме того, он очень популярен и востребован, имеет большое сообщество, то есть большое количество Docker-контейнеров или готовых конфигурационных файлов под разные задачи.

***Процесс:***
→ nginx конфигурируется с помощью конфигурационного файла `nginx.conf`;
→ в `nginx.conf` определяются виртуальные серверы (`server`) с помощью директивы `server_name`;
→ виртуальные серверы слушают определённый порт (обычно 80 для HTTP и 443 для HTTPS) и отвечают за обработку запросов к сайту;
→ в конфигурации определяются `location`-блоки, которые соответствуют URL-адресам и указывают, какие файлы или скрипты необходимо отдать в ответ на запрос;
→ nginx запускается и ожидает входящих запросов.

***Что в конфигурационном файле:***

*Блок `upstream` определяет группу серверов, которые будут принимать запросы. В нём указываются адреса и порты серверов.*

***Какие алгоритмы доступны:***
- `round-robin` — когда запросы направляются на каждый сервер по очереди;
- `least-conn` (это Least Connections) — когда запросы направляются на сервер с наименьшим количеством активных подключений;
- `ip-hash` (это хеширование по IP) — когда запросы от одного IP-адреса всегда направляются на один и тот же сервер.

***Вот как задать балансировку нагрузки в nginx:***
1. Создайте блок `upstream` в `nginx.conf`, указав адреса и порты серверов.
2. Создайте блок `server`, который будет слушать входящие запросы и перенаправлять их на группу серверов из `upstream`.
3. Укажите алгоритм балансировки в `proxy_pass`.

***Пример конфигурационного файла `nginx.conf` для балансировки нагрузки:***

```
upstream app_servers {

round-robin;

server server1.example.com:80 weight=1;

server server2.example.com:80 weight=1;

}

server {

listen 80;

server_name example.com;

location / {

proxy_pass http://app_servers;

}

} 
```

`upstream app_servers { ... }` — определяет группу серверов `app_servers`, которые будут обрабатывать запросы.
`proxy_pass http://app_servers;` — перенаправляет запросы на серверы из `app_servers`.
## ***Прокси и реверс-прокси***

***Основное различие между прокси и реверс-прокси заключается в направлении потока данных и, как следствие, в их функциях:***
- Прокси (Forward Proxy) перенаправляет запросы от клиента к серверу.
- Реверс-прокси (Reverse Proxy) перенаправляет запросы от клиента к одному или нескольким серверам.

***Реверс-прокси*** — это инструмент для управления веб-трафиком и обеспечения безопасности и производительности веб-ресурсов
![[Pasted image 20251116123212.png]]

